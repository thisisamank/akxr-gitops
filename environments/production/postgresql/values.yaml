# PostgreSQL Production Configuration

# Authentication - using existing sealed secret
auth:
  enablePostgresUser: true
  existingSecret: postgresql-secret
  secretKeys:
    adminPasswordKey: postgres-password
    userPasswordKey: password
    replicationPasswordKey: replication-password
  # Custom database and user
  username: "akxr"
  database: "akxr-prod"
  # Replication user
  replicationUsername: repl_user

# Architecture - standalone for production
architecture: standalone

# Image configuration
image:
  registry: docker.io
  repository: bitnami/postgresql
  tag: latest
  pullPolicy: IfNotPresent

# Primary PostgreSQL configuration
primary:
  # Resource limits and requests
  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 500m
      memory: 2Gi

  # Persistence configuration
  persistence:
    enabled: true
    storageClass: "longhorn"
    accessModes:
      - ReadWriteOnce
    size: 10Gi
    mountPath: /bitnami/postgresql

  # Service configuration
  service:
    type: ClusterIP
    ports:
      postgresql: 5432

  # Network policy
  networkPolicy:
    enabled: true
    allowExternal: false
    allowExternalEgress: true
    # Allow access from default namespace with production-postgresql-client label
    ingressNSMatchLabels:
      kubernetes.io/metadata.name: default
    ingressNSPodMatchLabels:
      production-postgresql-client: "true"

  # Pod disruption budget
  pdb:
    create: true
    minAvailable: 1

  # Node selector for production nodes
  nodeSelector:
    node-type: prod

  # Tolerations for production node taints
  tolerations:
    - key: node-type
      operator: Equal
      value: prod
      effect: NoSchedule

# Metrics and monitoring (optional)
metrics:
  enabled: false

# Read replicas (disabled for standalone)
readReplicas:
  replicaCount: 0

